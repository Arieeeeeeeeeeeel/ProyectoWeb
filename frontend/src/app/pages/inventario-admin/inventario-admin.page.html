<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button routerLink="/admin">
        <ion-icon name="arrow-back-outline"></ion-icon>
        Volver
      </ion-button>
    </ion-buttons>
    <ion-title>Inventario (Admin)</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Agregar Producto</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Nombre</ion-label>
        <ion-input [(ngModel)]="nuevoProducto.nombre" required></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Descripci칩n</ion-label>
        <ion-input [(ngModel)]="nuevoProducto.descripcion"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Marca</ion-label>
        <ion-input [(ngModel)]="nuevoProducto.marca" required></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Modelo</ion-label>
        <ion-input [(ngModel)]="nuevoProducto.modelo"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">A침o</ion-label>
        <ion-input type="number" [(ngModel)]="nuevoProducto.ano_compatible"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Stock</ion-label>
        <ion-input type="number" [(ngModel)]="nuevoProducto.stock" required min="0"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Precio</ion-label>
        <ion-input type="number" [(ngModel)]="nuevoProducto.precio" required min="0"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">URL de imagen</ion-label>
        <ion-input [(ngModel)]="nuevoProducto.imagen_url"></ion-input>
      </ion-item>
      <ion-item lines="none">
        <ion-checkbox [(ngModel)]="nuevoProducto.en_oferta">Oferta</ion-checkbox>
        <ion-checkbox [(ngModel)]="nuevoProducto.mostrar_en_inicio" style="margin-left:16px;">Mostrar en inicio</ion-checkbox>
      </ion-item>
      <ion-button expand="block" color="primary" (click)="agregarProducto()"
        [disabled]="!nuevoProducto.nombre || !nuevoProducto.marca || nuevoProducto.stock === undefined || nuevoProducto.stock < 0 || nuevoProducto.precio === undefined || nuevoProducto.precio < 0">
        Agregar
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Lista de Productos</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item lines="none">
        <ion-input placeholder="Buscar por nombre o modelo" [(ngModel)]="filtroBusqueda" (ionInput)="aplicarFiltro()"></ion-input>
        <ion-select placeholder="Filtrar por marca" [(ngModel)]="filtroMarca" (ionChange)="aplicarFiltro()" interface="popover" style="margin-left:8px; min-width:120px;">
          <ion-select-option *ngFor="let marca of marcasUnicas" [value]="marca">{{marca}}</ion-select-option>
        </ion-select>
        <ion-checkbox [(ngModel)]="filtroOferta" (ionChange)="aplicarFiltro()" style="margin-left:8px;">Solo ofertas</ion-checkbox>
      </ion-item>
      <ion-list>
        <ion-item *ngFor="let producto of productosFiltrados">
          <div *ngIf="editandoId !== producto.producto_id" style="width:100%;">
            <b>{{producto.nombre}}</b> - ${{producto.precio}}
            <ion-button fill="clear" color="primary" size="small" slot="end" (click)="editarProducto(producto.producto_id)">
              <ion-icon name="create-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="danger" size="small" slot="end" (click)="eliminarProducto(producto.producto_id)">
              <ion-icon name="trash-outline"></ion-icon>
            </ion-button>
          </div>
          <div *ngIf="editandoId === producto.producto_id" style="width:100%;">
            <ion-item>
              <ion-label position="floating">Nombre</ion-label>
              <ion-input [(ngModel)]="producto.nombre" required></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">Descripci칩n</ion-label>
              <ion-input [(ngModel)]="producto.descripcion"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">Marca</ion-label>
              <ion-input [(ngModel)]="producto.marca" required></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">Modelo</ion-label>
              <ion-input [(ngModel)]="producto.modelo"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">A침o</ion-label>
              <ion-input type="number" [(ngModel)]="producto.ano_compatible"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">Stock</ion-label>
              <ion-input type="number" [(ngModel)]="producto.stock" required min="0"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">Precio</ion-label>
              <ion-input type="number" [(ngModel)]="producto.precio" required min="0"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">URL de imagen</ion-label>
              <ion-input [(ngModel)]="producto.imagen_url"></ion-input>
            </ion-item>
            <ion-item lines="none">
              <ion-checkbox [(ngModel)]="producto.en_oferta">Oferta</ion-checkbox>
              <ion-checkbox [(ngModel)]="producto.mostrar_en_inicio" style="margin-left:16px;">Mostrar en inicio</ion-checkbox>
            </ion-item>
            <ion-button color="success" size="small" (click)="guardarEdicion(producto)"
              [disabled]="!producto.nombre || !producto.marca || producto.stock === undefined || producto.stock < 0 || producto.precio === undefined || producto.precio < 0">
              Guardar
            </ion-button>
            <ion-button color="medium" size="small" (click)="cancelarEdicion()">Cancelar</ion-button>
          </div>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
</ion-content>
